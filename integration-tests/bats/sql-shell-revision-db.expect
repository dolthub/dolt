#!/usr/bin/expect
source "$env(BATS_CWD)/helper/common_expect_functions.tcl"

set timeout 10
set env(NO_COLOR) 1

spawn dolt sql

expect_with_defaults {>} { send "create schema mydb;\r" }

expect_with_defaults {>} { send "use mydb;\r" }

expect_with_defaults {>} { send "call dolt_branch('branch1');\r" }

expect_with_defaults {>} { send "use \`mydb/branch1\`;\r" }

expect_with_defaults {>} { send "show databases;\r" }

expect_with_defaults_after {rows in set} {mydb/branch1\*?>} { send "use mydb;\r" }

expect_with_defaults {>} { send "use \`mydb@branch1\`;\r" }

expect_with_defaults_after {Database Changed} {mydb/branch1\*?>} { send "set dolt_enable_revision_delimiter_alias = 0;\r" }

expect_with_defaults {>} { send "create database `mydb@branch1`;\r" }

expect_with_defaults {>} { send "use `mydb@branch1`;\r" }

expect_with_defaults_after {Database Changed} {mydb@branch1/main*?>} { send "exit;\r" }

expect eof
exit 0
